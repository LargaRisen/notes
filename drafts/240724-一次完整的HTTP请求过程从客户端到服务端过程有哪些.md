# 一次完整的 HTTP 请求过程从客户端到服务端过程有哪些

> DNS 解析 --\> 建立 TCP 连接 --\> 发送 HTTP 请求 --\> 服务器处理请求 --\> 发送 HTTP 响应 --\> 客户端接收并处理响应 --\> 关闭 TCP 连接 --\> 渲染和执行

一次完整的 HTTP 请求过程从客户端到服务端涉及多个步骤。以下是详细的流程：

### 1. **DNS 解析**

客户端（通常是浏览器）首先需要将用户输入的域名解析为服务器的 IP 地址。这个过程涉及以下步骤：

- 浏览器缓存查找：浏览器首先检查其内部缓存中是否已有该域名的 IP 地址。
- 系统缓存查找：如果浏览器缓存中没有找到，则查询操作系统的缓存。
- 路由器缓存查找：如果系统缓存中也没有找到，则查询本地路由器的缓存。
- ISP DNS 查找：最后，如果所有缓存都没有命中，则查询 ISP 的 DNS 服务器，直至递归查询到权威 DNS 服务器并获得 IP 地址。

### 2. **建立 TCP 连接**

在获得服务器的 IP 地址后，客户端使用该地址和服务器建立 TCP 连接。这个过程使用三次握手协议：

- 客户端发送一个 SYN（同步）包到服务器。
- 服务器收到 SYN 包后，返回一个 SYN-ACK（同步-确认）包。
- 客户端收到 SYN-ACK 包后，再发送一个 ACK（确认）包，连接建立完成。

### 3. **发送 HTTP 请求**

TCP 连接建立后，客户端构建 HTTP 请求报文，并通过 TCP 连接发送到服务器。请求报文包括请求行、请求头部和请求主体（对于 POST 等方法）。

### 4. **服务器处理请求**

服务器收到 HTTP 请求后，处理请求并生成响应报文。处理过程包括：

- 解析请求行和请求头部。
- 根据请求路径和方法路由请求到相应的处理器。
- 执行业务逻辑，访问数据库或其他资源。
- 生成响应数据。

### 5. **发送 HTTP 响应**

服务器将生成的响应报文通过 TCP 连接发送回客户端。响应报文包括状态行、响应头部和响应主体。

### 6. **客户端接收并处理响应**

客户端接收到 HTTP 响应报文后，解析响应头部和响应主体。根据响应状态码和内容类型等信息，浏览器可能会渲染页面、处理数据或执行其他操作。

### 7. **关闭 TCP 连接**

如果不再需要保持连接，客户端和服务器将关闭 TCP 连接。这个过程使用四次挥手协议：

- 一方发送 FIN（终止）包，表示不再发送数据。
- 对方收到 FIN 包后，返回一个 ACK 包确认。
- 对方发送自己的 FIN 包，表示数据发送完毕。
- 第一方返回一个 ACK 包确认，连接关闭。

### 8. **渲染和执行**

客户端（如浏览器）在解析和处理 HTTP 响应后，会根据内容类型执行相应的操作，例如渲染 HTML、加载和执行 CSS 和 JavaScript 资源等。这可能会触发额外的 HTTP 请求（如加载图片、样式表、脚本等），重复上述步骤。

这个完整的 HTTP 请求过程涉及多个网络层次和协议，确保客户端与服务器之间的通信顺利进行。
