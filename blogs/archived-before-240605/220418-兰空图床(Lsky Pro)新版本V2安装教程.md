# 兰空图床(Lsky Pro)新版本V2安装教程

兰空图床(Lsky Pro)新版本V2快速搭建安装教程 - 设计笔记shejibiji.com

![image-20220418145122279](https://ossimg.yzitc.com/2022/04/18/cdfcaf2840e0a.png)

> 查看最终效果：[设计图床](https://pic.shejibiji.com)
>
> 如果依然喜欢第一代图床，可以访问这里：[圆子图床](https://img.yzitc.com/)

## 写在前面

LskyV2版本必须要求`PHP8.0.2`以上的版本，另外需要多个拓展，前期准备工作比较麻烦点，安装步骤和之前是差不多的。

LskyV2新版本实测界面稍微要好看一点，圆角更多。

感觉速度也要快一些，可能是因为使用了新的底层框架 Laravel，更加适合大项目和企业使用。

如果考虑长期使用，未来可能商业化项目的话，推荐升级。

个人使用，其实不升级也无所谓，以前的是完全够用的。

下面是官方总结的新特性：

### 对比旧版本有哪些新特性？

- 新的底层框架 Laravel
- 替换掉了 Bootstrap-fileinput 组件
- 更为多样化的角色组逻辑，多个角色组可设置多个储存策略，反过来亦然
- 全新的 UI，依旧是响应式的操作页面
- 新的我的图片管理页面，瀑布流布局、右键复制图片、复制链接、拖拽多选等操作
- 可视化的水印配置，支持九个方向以及平铺的方式设置水印，并且支持设置位置偏移量
- 图片管理使用缩略图展示，且访问缩略图生成不会消耗第三方储存(域名)的流量
- 增加了 AWS S3、SFTP、WebDav、Minio 的支持
- 得益于 Laravel，新版本支持多种数据库`Mysql 5.7+`、`PostgreSQL 9.6+`、`SQLite 3.8.8+`、`SQL Server 2017+`
- 使用相册功能取代了旧版本的多层文件夹分类功能

## 相关资料文档

> 程序下载：https://github.com/lsky-org/lsky-pro/releases
>
> 官方文档：[https://docs.lsky.pro/docs/v2/](https://docs.lsky.pro/docs/v2/#%E4%BB%8B%E7%BB%8D)
>
> 官方网站：https://www.lsky.pro/

###  介绍

Lsky Pro 是一个用于在线上传、管理图片的图床程序，中文名：兰空图床，你可以将它作为自己的云上相册，亦可以当作你的写作贴图库。
兰空图床始于 2017 年 10 月，最早的版本由 ThinkPHP 5 开发，后又经历了数个版本的迭代，在 2021 年末启动了新的重写计划并于 2022 年 3 月份发布全新的 2.0 版本。

###  特性

- 支持`本地`等多种第三方云储存 `AWS S3`、`阿里云 OSS`、`腾讯云 COS`、`七牛云`、`又拍云`、`SFTP`、`FTP`、`WebDav`、`Minio`
- 多种数据库驱动支持，`MySQL 5.7+`、`PostgreSQL 9.6+`、`SQLite 3.8.8+`、`SQL Server 2017+`
- 支持配置使用多种缓存驱动，`Memcached`、`Redis`、`DynamoDB`、等其他关系型数据库，默认以文件的方式缓存
- 多图上传、拖拽上传、粘贴上传、动态设置策略上传、复制、一键复制链接
- 强大的图片管理功能，瀑布流展示，支持鼠标右键、单选多选、重命名等操作
- 自由度极高的角色组配置，可以为每个组配置多个储存策略，同时储存策略可以配置多个角色组
- 可针对角色组设置上传文件、文件夹路径命名规则、上传频率限制、图片审核等功能
- 支持图片水印、文字水印、水印平铺、设置水印位置、X/y 轴偏移量设置、旋转角度等
- 支持通过接口上传、管理图片、管理相册
- 支持在线增量更新、跨版本更新
- 图片广场

### 安装要求

- PHP >= 8.0.2
- BCMath PHP 扩展
- Ctype PHP 扩展
- DOM PHP 拓展
- Fileinfo PHP 扩展
- JSON PHP 扩展
- Mbstring PHP 扩展
- OpenSSL PHP 扩展
- PDO PHP 扩展
- Tokenizer PHP 扩展
- XML PHP 扩展
- Imagick 拓展
- exec、shell_exec 函数
- readlink、symlink 函数
- putenv、getenv 函数

## 安装步骤

1、

配置基础环境

首先按照上面的安装要求，配置基础环境。

PHP版本要求必须是8.0.2以上的，安装前自动检查，不是就会报错。



2、

**新建网站，并上传程序**

新建网站，并在前面提供的下载地址，下载最新版本的程序。

![image-20220418141902486](https://ossimg.yzitc.com/2022/04/18/b8ed5362af510.png)

下载后，上传到网站目录并解压：

![image-20220415160826690](https://ossimg.yzitc.com/2022/04/15/09cef5c8b1e2d.png)

3、

**配置网站，设置伪静态**

修改网站目录为`public`文件夹。

取消防跨站攻击，否则会有意想不到的错误。简单来说，open_basedir 是用来限制 PHP 读取目录。

![image-20220415160905548](https://ossimg.yzitc.com/2022/04/15/253e4f3cf82c6.png)

修改网站伪静态为：

```nginx
location / {
  try_files $uri $uri/ /index.php?$query_string;
}
```

![image-20220415160700627](https://ossimg.yzitc.com/2022/04/15/2930e334639f9.png)

4、

**访问域名，开始安装**

配置好网站域名，并使用域名访问网站，会自动跳转至安装页面。

程序会自动检测环境，并引导安装。



如果检测不通过，查看未安装的拓展，都解决就好。

比如我这边检测出有`拓展和函数`未安装：

![image-20220418155218518](https://ossimg.yzitc.com/2022/04/18/244e86d11ba16.png)

把未安装的拓展找到并安装：

![image-20220418155508595](https://ossimg.yzitc.com/2022/04/18/bc6e55118c311.png)

缺少的函数，我们可以通过禁用函数来添加。

*别问我，我也没理解为什么缺少的函数，禁用即可添加了*）

![image-20220418161129766](https://ossimg.yzitc.com/2022/04/18/59684d6142594.png)

> \* 安装拓展删除函数后，记得重启下php，才能生效。
>
> \* 禁用函数时，推荐找到函数点删除来禁用，直接输入名称禁用有可能会出现未知的错误！
>
> （这个错误可能是由于部分函数默认已经禁用，于是发生了奇怪的错误，我安装时报了500错误，后面通过重新安装php8.0解决了！ ）



刷新下安装界面，如果出现`下一步`，表示环境检测都通过了。

![image-20220418164618244](https://ossimg.yzitc.com/2022/04/18/39237d69e9965.png)



下一步**配置数据库和管理员账号**：

![image-20220418164940765](https://ossimg.yzitc.com/2022/04/18/de301627d276d.png)



出现这个界面就表示安装成功了：

![image-20220418165049970](https://ossimg.yzitc.com/2022/04/18/2ea6dce0d6f8e.png)



接下来就可以通过域名来访问图床了：

![image-20220418142521014](https://ossimg.yzitc.com/2022/04/18/f809bd4b88f76.png)

现在就可以愉快的使用了。

