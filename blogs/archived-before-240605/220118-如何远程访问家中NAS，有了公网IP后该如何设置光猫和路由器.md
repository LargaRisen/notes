### 有了公网IP后该如何设置光猫和路由器，远程访问家中威联通NAS

> **参考文章**
>
> [NAS之路 篇三：10年域名只要45，公网IP配合腾讯云DDNS实现外网访问NAS](https://post.smzdm.com/p/a25d5rln/)
>
> （实现了自定义域名访问NAS）
>
> [不花一分钱，随时找到大别墅里的小姐姐（外网极速免费访问NAS保姆级教程）](https://post.smzdm.com/p/avwdxe8p/)
>
> （讲的比较仔细，动态DNS使用的是公网3322.org）
>

![2022-01-20_11-38-38](https://ossimg.yzitc.com/2022/01/20/69caa754d2e64.jpg)

使用官方提供的远程连接方案，速度普遍较慢，推荐还是搞一个公网IP来远程访问家中NAS。

这样远程使用体验就和家中直接连接NAS差不多，墙裂推荐配置。

那么我就简单分享下如何利用公网IP，远程访问家中NAS。

### 一、申请公网IP

公网IP现在申请应该都不难，多联系客服尝试下即可。

我是打联通客服电话申请的，客服甚至都没问为什么，就给我提交了。

之后另外一位客服打电话过来，问我是否确认要开通公网IP，得到确切答复后挂了电话，几分钟后收到短信显示公网IP已开通。

#### 如何查看公网IP是否已开通？

首先登录路由器管理界面，查看本地IP地址。

（演示截图来自小米路由器，其他路由器应该都类似）

![image-20220120110659452](https://ossimg.yzitc.com/2022/01/20/12fc3ea3af096.png)

搜索引擎输入IP，第一个结果，就会显示本机IP。

![image-20220120110733896](https://ossimg.yzitc.com/2022/01/20/faee3afbd555d.png)

和上面的IP地址核对下，发现地址一致，表示公网IP已经有了。



### 二、光猫改桥接模式

因为现在宽带默认都是**路由连接**，无法设置端口转发，这样通过公网IP还是找不到家里的具体设备。

这个时候我们就可以通过把光猫改成桥接模式，让路由器去拨号上网，就可以在路由器上设置端口转发，实现远程公网IP的访问。

这一步我最终是找安装师傅帮忙完成了，所以这里无法分享详细过程。

（白天上班，安装师傅不进家门，在门口连接我家WIFI就调好的，还是很方便的）



> 下面的是我之前自己尝试时候的一些经验，可以跳过不看，在此记录下，用于自己日后查询使用：
>
> 1.
>
> **过程**
>
> 我刚开始是自己尝试改的，但是因为家里联通宽带密码，不是默认的123456，登录光猫后台，密码被掩码加密了，无法直接查看。导致自己设置桥接后，无法成功拨号。
>
> 光猫改桥接后，输入192.168.1.1进不去管理后台了，想恢复都不行。
>
> 于是用网线将光猫和电脑连接，来勉强恢复到之前的状态，但是因为宽带密码问题还是无法连接宽带。
>
> 2.
>
> **经验**
>
> 折腾了很久，可以分享下自己学到的一些经验：
>
> 其实超级管理员密码都比较好拿到，网上搜搜都能找到。比如上海联通超级管理员密码是：CUAdmin
>
> 登录超级管理员后台后，可以在基本配置，上行线路配置中，查看到用户名、VLAN ID和密码，记下他们（如下图）。
>
> ![联通后台截图](https://ossimg.yzitc.com/2022/01/18/55de92210642e.png)
>
> 然后删除旧的配置，新建一个，连接模式改成桥接，其他的参考之前的配置。
>
> 然后在LAN配置中，关闭DHCP。
>
> 之后在路由器上网方式里面，选择PPPoE，输入账号和密码，不出意外，应该就可以正常上网了。



### 三、路由器设置端口转发

1.

**添加端口转发规则**

（以小米路由器做演示，其它路由后台操作应该类似，可作为参考）

我们登录路由器后台，找到端口转发，点击添加规则

![image-20220119202402304](https://ossimg.yzitc.com/2022/01/19/314c49370ef9e.png)

![image-20220119202832633](https://ossimg.yzitc.com/2022/01/19/45d762c7875fa.png)

然后点击保存并生效即可设置完成！

![image-20220119203252352](https://ossimg.yzitc.com/2022/01/19/5f4902c324633.png)

这个时候，我们在浏览器，输入公网IP:5000，即可快速访问家里的NAS了。

类似这样：http://114.177.65.27:5000/

打开后，就可以看到NAS的登录界面。

![image-20220119212059408](https://ossimg.yzitc.com/2022/01/19/0799e8a80dbc0.png)

这样就可以实现远程访问家里的NAS了，使用起来和家里局域网访问是一样的，速度也很快，体验不错！

### 四、设置动态DNS

虽然有公网IP，但是在重启路由器或者断网重连后，会自动更换，如果在外地，IP更改后，就无法通过直接的IP访问家里的NAS了。

我们可以利用动态DNS，也就是DDNS，**通过一个固定的域名**，来实现访问，这样就避免了公网IP更换的烦恼。

威联通有提供官方的动态DNS域名，我们可以直接配置使用。

首先，我们打开威联通的云连通：

![image-20220120111402658](https://ossimg.yzitc.com/2022/01/20/376b34d5e6441.png)

找到My DDNS，点击启用即可。

![image-20220120111725367](https://ossimg.yzitc.com/2022/01/20/73b0dc91975d8.png)

之后就可以通过类似：XX.myqnapcloud.cn:5000 来远程访问家中的NAS了。

威联通DDNS会自动获取最新的DDNS。

> **拓展内容：如何设置自定义域名**
>
> （内容留存，未实际配置）
>
> 打开威联通控制台，找到网络与虚拟交换机，点击打开。
>
> ![image-20220120112027666](https://ossimg.yzitc.com/2022/01/20/8fe8ef47dcd58.png)
>
> 打开后，找到DDNS，点击新增
>
> ![image-20220120112042506](https://ossimg.yzitc.com/2022/01/20/5a88697ee4b29.png)
>
> 可以自己选择免费的DDNS服务（实际列表中大部分都是收费的），推荐[No-IP](https://www.noip.com/)，国内的PubYun(3322)等都开始收费了。
>
> ![image-20220120112107015](https://ossimg.yzitc.com/2022/01/20/748843422a6a7.png)
>
> 或者选择Customized（自定义），使用腾讯云或者阿里云注册的域名来配置。
>
> 阿里云的可以直接用这个Github项目来配置：[aliyun-ddns](https://github.com/yyqian/aliyun-ddns)
>
> 注意DDNS自定义中的用户名和密码，实际上是平台ID和私钥，主机名称就是自己配置的域名。

